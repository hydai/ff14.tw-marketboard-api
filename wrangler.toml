name = "ff14-tw-marketboard"
main = "src/index.ts"
compatibility_date = "2025-12-01"
compatibility_flags = ["nodejs_compat"]

# Cron triggers
[triggers]
crons = [
  "0 4 * * *",     # Daily 04:00 UTC: maintenance (rollup + cleanup)
  "30 * * * *",    # Hourly at :30: price dispatch + item sync + aggregation
]

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "marketboard-db"
database_id = "c3fd481a-1b5e-416d-b75d-c114f70a5e9e"
migrations_dir = "migrations"

# KV Namespace
[[kv_namespaces]]
binding = "KV"
id = "b45d33e2500847dc83dd2765e701da56"

# Queue Producer
[[queues.producers]]
binding = "MARKET_QUEUE"
queue = "market-data"

# Queue Consumer
[[queues.consumers]]
queue = "market-data"
max_batch_size = 1
max_batch_timeout = 5
max_retries = 3
max_concurrency = 6  # Stay under Universalis 8 concurrent connection limit

# R2 Bucket (optional, for data exports)
# [[r2_buckets]]
# binding = "EXPORTS"
# bucket_name = "marketboard-exports"

# Observability
[observability]
[observability.logs]
enabled = true
invocation_logs = true

[vars]
DATACENTER_ID = "151"
DATACENTER_NAME = "陸行鳥"
REGION_CODE = "8"
ENVIRONMENT = "production"
